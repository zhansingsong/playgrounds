<!DOCTYPE html>
<html>
<head>
    <title>Converted from: 关于z-index的一些事.md</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

</head>
<body>

<h1 id="heading.51734e8ez-index76844e004e9b4e8b">关于z-index的一些事</h1>
<p>一般<strong>z-index</strong>失效基本上都是不了解<strong>z-index</strong>是如何工作导致的（这没有看这篇<a href="https://philipwalton.com/articles/what-no-one-told-you-about-z-index/">blog</a>之前，至少我也是这样的）。它不复杂，但如果不花时间去查看z-index文档，可能会不了解一些关键技术点。</p>
<p>不信？能否解答如下问题，作为检验你是否真正了解<strong>z-index</strong>：</p>
<h2 id="heading.95ee9898ff1a">问题：</h2>
<p>HTML结构如下：</p>
<pre><code class="language-HTML">&lt;div&gt;
  &lt;span class=&quot;red&quot;&gt;Red&lt;/span&gt;
&lt;/div&gt;
&lt;div&gt;
  &lt;span class=&quot;green&quot;&gt;Green&lt;/span&gt;
&lt;/div&gt;
&lt;div&gt;
  &lt;span class=&quot;blue&quot;&gt;Blue&lt;/span&gt;
&lt;/div&gt;
</code></pre>
<p>CSS如下：</p>
<pre><code class="language-css">.red, .green, .blue {
  position: absolute;
}
.red {
  background: red;
  z-index: 1;
}
.green {
  background: green;
}
.blue {
  background: blue;
}
</code></pre>
<h3 id="heading.59824f555c06201c7ea282725757201d653e7f6e201c7eff82725757201d4e4b540eff0c970089816ee18db359824e0b67614ef6ff1a">如何将“红色块”放置“绿色块”之后，需要满足如下条件：</h3>
<ul>
<li>不能修改html结构</li>
<li>不能修改任何元素的z-index属性</li>
<li>不能修改任何元素的position属性</li>
</ul>
<h3 id="heading.codepen8ff1a">codepen：</h3>
<iframe height='320' scrolling='no' title='JyNRxj' src='//codepen.io/zhansingsong/embed/JyNRxj/?height=330&theme-id=dark&default-tab=css,result&embed-version=2' frameborder='no' allowtransparency='true' allowfullscreen='true' style='width: 100%;'>See the Pen <a href='https://codepen.io/zhansingsong/pen/JyNRxj/'>JyNRxj</a> by zhansingsong (<a href='https://codepen.io/zhansingsong'>@zhansingsong</a>) on <a href='https://codepen.io'>CodePen</a>.
</iframe>
<h2 id="heading.89e351b365b96cd5">解决方法</h2>
<p>给第一个<code>div</code>（即“红色块”的父节点）添加如下样式：</p>
<pre><code class="language-css">  div:first-child {
    opacity: .99;
  }
</code></pre>
<p>或许你会好奇为什么这个<code>opacity</code>会让“红色块”置于“绿色块”之后（当时我看这个答案也是一脸懵逼了😑）。希望下文能解惑你的好奇。</p>
<h3 id="heading.z-index-5bspecification5d28https3a2f2fwww.w3.org2ftr2fcss22fvisuren.html23propdef-z-index29">z-index <a href="https://www.w3.org/TR/CSS2/visuren.html#propdef-z-index">specification</a></h3>
<p><strong>z-index</strong>只对<strong>positioned元素</strong>（即该元素的<code>position</code>不等于默认<code>static</code>外的值）起作用。对应<code>positoned box</code>（positioned元素)，<strong>z-index</strong>主要：</p>
<ol>
<li>指定该元素在当前<strong>stacking context</strong>的stack层级</li>
<li>该元素是否创建新的<strong>stacking context</strong></li>
</ol>
<p><strong>z-index</strong>可以取如下值：</p>
<ul>
<li>
<p><strong>(integer)整数</strong>：表示当前元素在当前的<strong>stacking context</strong>的stack层级，并会让当前元素创建一个新的<strong>stacking context</strong></p>
</li>
<li>
<p><strong>auto</strong>: 表示当前元素在当前的<strong>stacking context</strong>的stack层级为0，如果该元素不是<strong>root</strong>元素，就不会创建新的<strong>stacking context</strong></p>
</li>
</ul>
<h3 id="heading.stacking-order">stacking order</h3>
<p><strong>stacking context</strong>可以相互嵌套，每个元素（box）都属于一个<strong>stacking context</strong>（自包含），每个<code>positoned box</code>在一个<strong>stacking context</strong>中都有一个整数的stack层级，它表示在同一个<strong>stacking context</strong>中的z轴方向stack层级位置。stack层级越大在<strong>stacking context</strong>中的位置越靠前。如果stack层级相同，按其在DOM文档中出现顺序绘制。</p>
<h3 id="heading.stacking-context">stacking context</h3>
<blockquote>
<p><strong>The stacking context</strong> is a three-dimensional conceptualization of HTML elements along an imaginary z-axis relative to the user who is assumed to be facing the viewport or the webpage. HTML elements occupy this space in priority order based on element attributes.——MDN</p>
</blockquote>
<p><strong>stacking context</strong>的形成条件：</p>
<ul>
<li>文档根节点（HTML）| Root element of document (HTML).</li>
<li>元素的position属性值为<code>absolute</code>或<code>relative</code>，并且z-index属性为除<code>auto</code>外的值 | Element with a position value “absolute” or “relative” and z-index value other than “auto”.</li>
<li>元素的position属性值为<code>fixed</code>或<code>sticky</code> | Element with a position value “fixed” or “sticky” (sticky for all mobile browsers, but not older desktop).</li>
<li>元素是flexbox容器的子元素，带有z-index属性，且值为除<code>auto</code>外的值 | Element that is a child of a flex (flexbox) container, with z-index value other than “auto”.</li>
<li>元素的opcity属性值小于1 | Element with a opacity value less than 1 (See the specification for opacity).</li>
<li>元素的<a href="https://developer.mozilla.org/en-US/docs/Web/CSS/mix-blend-mode">mix-blend-mode</a>属性值为除<code>normal</code>外的值 | Element with a mix-blend-mode value other than “normal”.</li>
<li>元素的如下属性值为除<code>none</code>外的值 | Element with any of the following properties with value other than “none”:
<ul>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/CSS/transform">transform</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/CSS/filter">filter</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/CSS/perspective">perspective</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/CSS/clip-path">clip-path</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/CSS/mask">mask</a> / <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/mask-image">mask-image</a> / <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/mask-border">mask-border</a></li>
</ul>
</li>
<li>元素的isolation属性值为<code>isolate</code> | Element with a <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/isolation">isolation</a> value “isolate”.</li>
<li>元素的-webkit-overflow-scrolling属性值为<code>touch</code> | Element with a -webkit-overflow-scrolling value “touch”.</li>
<li>元素带有<a href="https://developer.mozilla.org/en-US/docs/Web/CSS/will-change">will-change</a>属性 | Element with a will-change value specifying any property that would create a stacking context on non-initial value (see this post).</li>
</ul>
<h3 id="heading.painted-order20in20stacking20context">painted order in stacking context</h3>
<ol>
<li>形成<strong>stacking context</strong>元素的<code>background</code>和<code>borders</code> | the background and borders of the element forming the stacking context.</li>
<li>负数的stack层级的<strong>child stacking context</strong>(负数值越大越前) | the child stacking contexts with negative stack levels (most negative first).</li>
<li>文档流中非inline级、非positioned子节点 | the in-flow, non-inline-level, non-positioned descendants.</li>
<li>非positioned浮动子节点 | the non-positioned floats.</li>
<li>文档流中非positioned的inline级子节点（包括inline tables和inline blocks） | the in-flow, inline-level, non-positioned descendants, including inline tables and inline blocks.</li>
<li>stack层级为0的<strong>child stacking context</strong>和positoned子节点 | the child stacking contexts with stack level 0 and the positioned descendants with stack level 0.</li>
<li>stack层级为正整数的<strong>child stacking context</strong> | the child stacking contexts with positive stack levels (least positive first).</li>
</ol>
<h3 id="heading.example">Example</h3>
<iframe height='265' scrolling='no' title='stackLevel' src='//codepen.io/zhansingsong/embed/WEMrNK/?height=265&theme-id=dark&default-tab=css,result&embed-version=2' frameborder='no' allowtransparency='true' allowfullscreen='true' style='width: 100%;'>See the Pen <a href='https://codepen.io/zhansingsong/pen/WEMrNK/'>stackLevel</a> by zhansingsong (<a href='https://codepen.io/zhansingsong'>@zhansingsong</a>) on <a href='https://codepen.io'>CodePen</a>.
</iframe>
<h2 id="heading.53c2800365877ae0ff1a">参考文章：</h2>
<ul>
<li><a href="https://philipwalton.com/articles/what-no-one-told-you-about-z-index/">What No One Told You About Z-Index</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_Positioning/Understanding_z_index/The_stacking_context">The stacking context</a></li>
<li><a href="https://www.w3.org/TR/CSS2/visuren.html#propdef-z-index">Specifying the stack level: the ‘z-index’ property</a></li>
</ul>


</body>
</html>
